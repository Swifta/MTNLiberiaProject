<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core">
    <h:body>
        <p:growl rendered="true"/>

        <div id="canvas">
            <p:tabView styleClass="elevens bolds" dynamic="true" activeIndex="#{schoolBean.activeIndex}">
                <p:ajax event="tabChange" listener="#{schoolBean.onTabChange}" update=":form:growl"/>   
                <p:tab title="Manage Schools" id="manageschool">
                    <p:dialog header="Add New School" widgetVar="school" styleClass="elevens bolds" width="450" resizable="false" modal="true">
                        <h:form>
                            <h:panelGrid styleClass="elevens" columns="2" style="width : 90%;margin: 0 auto">

                                <h:outputLabel value="School Name : "/>
                                <h:inputText value="#{schoolBean.school.name}" styleClass="elevens padded" size="35" required="true" requiredMessage="School Name required" validatorMessage="Validation Error: Ensure the school's name doesn't contain special characters, space and is between 4 to 50-character lenght">
                                    <f:validateRegex pattern="^[^-!@~#$%/\\|][\w\s]{3,50}$" />
                                </h:inputText>
                                <h:outputLabel value="School Code : "/>
                                <h:inputText value="#{schoolBean.school.schoolCode}" styleClass="elevens padded" size="35" required="true" requiredMessage="School Code required" validatorMessage="Validation Error: Ensure the school registration code doesn't contain special characters, space and has  2-character lenght">
                                    <f:validateRegex pattern="^[^-!@~#$%/\\|][a-zA-Z0-9]{1,1}" />
                                </h:inputText>
                                <!--  <h:outputLabel value="Pick a payment mode"/>
                                                                 <h:selectOneMenu styleClass="elevens padded" value="#{schoolBean.school.paymentModeId}">
                                                                     <f:selectItem itemLabel="Select a payment mode"/>
                                                                     <f:selectItems value="#{portalAdminBean.paymentModes}" var="paymentMode" itemLabel="#{paymentMode.type}" itemValue="#{paymentMode.id}"/> 
                                                                 </h:selectOneMenu>
                                                                 <h:outputLabel value="Pick a partner type"/>
                                                                 <h:selectOneMenu styleClass="elevens padded" value="#{schoolBean.school.partnerServiceId}">
                                                                     <f:selectItem itemLabel="Select a partner service"/>
                                                                     <f:selectItems value="#{portalAdminBean.partnerServices}" var="partnerService" itemLabel="#{partnerService.name}" itemValue="#{partnerService.id}"/> 
                                                                 </h:selectOneMenu> -->
                                <h:outputLabel value=""/>
                                <h:commandButton value="Create School" styleClass="buttons elevens whites bolds padded" style="color : #fff;" action="#{schoolBean.createSchool()}"/> 
                            </h:panelGrid>                    
                        </h:form>
                    </p:dialog>
                    <div style="text-align: right;padding: 5px;" class="elevens">
                        <h:form>
                            <p:commandButton value="Add School" styleClass="elevens bolds" onclick="school.show();"/>
                            <p:spacer width="20"/>
                            <p:commandButton value="Log Out" styleClass="elevens bolds" action="#{portalAdminBean.logOut()}" ajax="false"/>
                        </h:form>
                    </div>
                    <br />
                    <h:form> <p:dataTable paginator="true" rows="20"  
                                          paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                          rowsPerPageTemplate="5,10,15" styleClass="elevens datatables" value="#{portalAdminBean.schools}" var="schools">
                            <f:facet name="header">List of Schools</f:facet>
                            <p:column headerText="School Name" sortBy="#{schools.name}">
                                <h:outputLabel value="#{schools.name}"/>
                            </p:column><p:column headerText="School Code" sortBy="#{schools.schoolCode}">
                                <h:outputLabel value="#{schools.schoolCode}"/>
                            </p:column>
                         <!--   <p:column headerText="Payment Mode Name" sortBy="#{schools.paymentModeType}">
                                <h:outputLabel value="#{schools.paymentModeType}"/>
                            </p:column>
                            <p:column headerText="Partner Service" sortBy="#{schools.partnerServiceName}">
                                <h:outputLabel value="#{schools.partnerServiceName}"/>
                            </p:column>  --><p:column style="width:5%" >  
                                <p:commandLink value="Edit" action="#{schoolBean.retrieveSchool(schools.id)}" style="width:5%"> 
                                </p:commandLink>  
                            </p:column>                   
                        </p:dataTable></h:form></p:tab>
                <p:tab title="Manage School Admin" id="manageadmin">
                    <p:dialog header="New School Admin" widgetVar="admin" styleClass="elevens bolds" width="450" height="250" resizable="false" modal="true">
                        <h:form>
                            <h:panelGrid styleClass="elevens" columns="2" style="width : 80%;margin: 0 auto">
                                <h:outputLabel value="Pick a school"/>
                                <h:selectOneMenu styleClass="elevens padded" value="#{schoolBean.admin.schoolID}">
                                    <f:selectItem itemLabel="Select a school"/>
                                    <f:selectItems value="#{portalAdminBean.schools}" var="school" itemLabel="#{school.name}" itemValue="#{school.id}"/> 
                                </h:selectOneMenu>
                                <h:outputLabel value="First Name : "/>
                                <h:inputText value="#{schoolBean.admin.firstName}" styleClass="elevens padded" size="35" required="true" requiredMessage="First Name required" validatorMessage="Validation Error: Ensure the first name doesn't contain special characters, space and is between 3 to 15-character lenght">
                                    <f:validateRegex pattern="^[^-!@~#$%/\\|][a-zA-Z]{2,15}" />
                                </h:inputText>
                                <h:outputLabel value="Last Name : "/>
                                <h:inputText value="#{schoolBean.admin.lastName}" styleClass="elevens padded" size="35" required="true" requiredMessage="Last Name required" validatorMessage="Validation Error: Ensure the last name doesn't contain special characters, space and is between 3 to 15-character lenght">
                                    <f:validateRegex pattern="^[^-!@~#$%/\\|][a-zA-Z]{2,15}" />
                                </h:inputText>
                                <h:outputLabel value="Mobile : "/>
                                <h:inputText value="#{schoolBean.admin.phoneNo}" styleClass="elevens padded" size="35" required="true" requiredMessage="Mobile required" validatorMessage="Validation Error: Ensure the mobile number doesn't contain special characters, space and is between 6 to 15-character lenght">
                                    <f:validateRegex pattern="^[^-!@~#$%/\\|][0-9]{5,15}" />
                                </h:inputText>
                                <h:outputLabel value="Email Address : "/>
                                <h:inputText value="#{schoolBean.admin.emailAddress}" styleClass="elevens padded" size="35" required="true" requiredMessage="Email Address required" validatorMessage="Validation Error: Ensure this contains a valid email address">
                                    <f:validateRegex pattern="[\w\.-]*[a-zA-Z0-9_]@[\w\.-]*[a-zA-Z0-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]" />
                                </h:inputText>
                                <h:outputLabel value=""/>
                                <h:commandButton value="Create Admin" styleClass="buttons elevens whites bolds padded" style="color : #fff;" action="#{schoolBean.createAdmin()}"/> 
                            </h:panelGrid>                    
                        </h:form>
                    </p:dialog>
                    <div style="text-align: right;padding: 5px;" class="elevens">
                        <h:form>
                            <p:commandButton value="Create School Admin" styleClass="elevens bolds" onclick="admin.show();"/>
                            <p:spacer width="20"/>
                            <p:commandButton value="Log Out" styleClass="elevens bolds" action="#{portalAdminBean.logOut()}" ajax="false"/>
                        </h:form>
                    </div>
                    <br />
                    <h:form>
                        <p:dataTable paginator="true" rows="20"  
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                     rowsPerPageTemplate="5,10,15" styleClass="elevens datatables" value="#{portalAdminBean.admins}" var="admin">
                            <f:facet name="header">List of School Administrators</f:facet>
                            <p:column headerText="First Name" sortBy="#{admin.firstName}">
                                <h:outputLabel value="#{admin.firstName}"/>
                            </p:column>
                            <p:column headerText="Last Name" sortBy="#{admin.lastName}">
                                <h:outputLabel value="#{admin.lastName}"/>
                            </p:column>
                            <p:column headerText="Username" sortBy="#{admin.username}">
                                <h:outputLabel value="#{admin.username}"/>
                            </p:column>                    
                            <p:column headerText="Email Address" sortBy="#{admin.emailAddress}">
                                <h:outputLabel value="#{admin.emailAddress}"/>
                            </p:column>
                            <p:column headerText="Mobile" sortBy="#{admin.phoneNo}">
                                <h:outputLabel value="#{admin.phoneNo}"/>
                            </p:column>                    
                            <p:column headerText="Name of School" sortBy="#{admin.schoolName}">
                                <h:outputLabel value="#{admin.schoolName}"/>
                            </p:column>  
                            <p:column style="width:5%" >  
                                <p:commandLink value="Edit" action="#{schoolBean.retrieveSchoolAdmin(admin.id)}"> 
                                </p:commandLink>  
                            </p:column>         
                        </p:dataTable>
                    </h:form>
                </p:tab>
                <p:tab title="Transaction History" id="transhist">       
                    <div style="text-align: right;padding: 5px;" class="elevens">
                        <h:form>
                            <p:commandButton value="Log Out" styleClass="elevens bolds" action="#{portalAdminBean.logOut()}" ajax="false"/>
                        </h:form>
                    </div>
                    <h:form><h:panelGrid styleClass="elevens bolds" columns="2" style="width : 90%;margin: 0 auto">
                            <h:outputLabel value="Select a school and wait for transactions to reload"/>
                            <h:selectOneMenu styleClass="elevens padded" value="#{schoolBean.admin.schoolID}">
                                <p:ajax listener="#{schoolBean.retrieveSelectedSchool(schoolBean.admin.schoolID)}" event="valueChange"/>
                                <f:selectItem itemLabel="Select a school"/>
                                <f:selectItems value="#{portalAdminBean.schools}" var="school" itemLabel="#{school.name}" itemValue="#{school.id}"/> 
                            </h:selectOneMenu></h:panelGrid>
                        <p:dataTable paginator="true" rows="20"  
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                     rowsPerPageTemplate="5,10,15" styleClass="elevens datatables" value="#{schoolBean.histories}" var="history" id="txnHistory">
                            <f:facet name="header">Transaction History</f:facet>
                            <p:column headerText="Name of Student">
                                <h:outputLabel value="#{history.studentName}"/>
                            </p:column>
                            <p:column headerText="Amount Paid">
                                <h:outputLabel value="#{history.amountPaid}"/>
                            </p:column>                        
                            <p:column headerText="Paid By">
                                <h:outputLabel value="#{history.paidBy}"/>
                            </p:column>                        
                            <p:column headerText="Payment Reference">
                                <h:outputLabel value="#{history.paymentRef}"/>
                            </p:column>                        
                            <p:column headerText="Fundamo Transaction ID">
                                <h:outputLabel value="#{history.transactionID}"/>
                            </p:column>                        
                            <p:column headerText="Date">
                                <h:outputLabel value="#{history.date}"/>
                            </p:column>                        
                        </p:dataTable>                    
                        <p:poll interval="5" listener="#{schoolBean.getHistories()}" update="txnHistory" /></h:form>
                </p:tab>      
            </p:tabView>
        </div>
    </h:body>
</html>

